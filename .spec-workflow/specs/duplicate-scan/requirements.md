# 要件定義書

## はじめに

macOS向けのデスクトップアプリケーションで、重複する画像・動画ファイルを検出・削除します。ローカルストレージとFinder経由でマウントされたリモートストレージ（NAS、Google Drive、Dropboxなど）の両方をスキャン対象とします。

## プロダクトビジョンとの整合性

このツールは、様々なストレージメディアに散在する重複ファイルが占有するストレージ容量を解放し、ユーザーがメディアライブラリを整理するのを支援することを目的としています。

## 要件

### 要件1: マルチソーススキャン

**ユーザーストーリー:** ユーザーとして、ローカルMac、NAS、クラウドドライブ（Google Drive、Dropbox）から複数のフォルダを選択し、すべてのストレージロケーション全体で重複を見つけたい。

#### 受け入れ基準

1. ユーザーがアプリを開いたとき、システムは複数のフォルダパスを追加できるようにすること
2. フォルダがマウントされたネットワークドライブ（NAS）またはクラウドドライブ（Google Drive、Dropbox）上にある場合、システムはファイルシステム経由で透過的にアクセスすること
3. ユーザーがスキャンを開始したとき、システムは選択されたすべてのフォルダを再帰的にスキャンすること

### 要件2: メディアファイルのサポート

**ユーザーストーリー:** ユーザーとして、他の重要なドキュメントを誤って削除しないよう、アプリが画像と動画に焦点を当てることを望む。

#### 受け入れ基準

1. ファイルをスキャンするとき、システムは一般的な画像フォーマット（JPG、PNG、HEIC、GIF、TIFFなど）を識別すること
2. ファイルをスキャンするとき、システムは一般的な動画フォーマット（MP4、MOV、AVI、MKVなど）を識別すること
3. ファイルがサポートされているメディアタイプでない場合、システムはそれを無視すること

### 要件3: コンテンツベースの重複検出

**ユーザーストーリー:** ユーザーとして、ファイル名が異なっていても重複を見つけて、リネームされたコピーをクリーンアップしたい。

#### 受け入れ基準

1. ファイルを比較するとき、システムはコンテンツハッシュ（MD5、SHA-256など）または視覚的類似性（オプション、まずは完全一致ハッシュから開始）を使用して重複を識別すること
2. 2つのファイルが異なる名前を持つが同一のコンテンツである場合、システムはそれらを重複としてマークすること

### 要件4: レビューと削除

**ユーザーストーリー:** ユーザーとして、見つかった重複をレビューし、どれを保持するか選択して、好みのコピー（整理されたフォルダ内のものなど）を失わないようにしたい。

#### 受け入れ基準

1. スキャンが完了したとき、システムは重複ファイルのグループを表示すること
2. グループを表示しているとき、システムはユーザーが削除するファイルを選択できるようにすること
3. ユーザーが削除を確認したとき、システムは選択されたファイルをゴミ箱に移動する（可能な場合）か、警告付きで完全に削除すること

## 非機能要件

### コードアーキテクチャとモジュール性
- **単一責任の原則**: 各ファイルは単一の明確に定義された目的を持つべき
- **モジュラー設計**: コンポーネント、ユーティリティ、サービスは分離され再利用可能であるべき
- **依存関係管理**: モジュール間の相互依存を最小限に抑える
- **明確なインターフェース**: コンポーネントとレイヤー間のクリーンな契約を定義する

### パフォーマンス
- スキャンプロセスは、ネットワークドライブ上の大規模なライブラリを処理する際にUIをフリーズさせないよう十分に効率的であること
- ファイルハッシュは最適化されるべき（例：最初に部分チャンクを読み取る）、ネットワーク経由での不要な完全ファイル読み取りを避けるため

### ユーザビリティ
- フォルダ選択と結果レビューのためのシンプルでクリーンなインターフェース
- スキャン中の進捗表示
